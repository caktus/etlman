<script type="module">
  let monacoEditor = createEditor(
    "id_{{ widget.name }}",
    `{% if widget.value != None %}{{ widget.value | escapejs }}{% endif %}`
  );

  const forms = document.getElementsByTagName("form");
  for (let index = 0; index < forms.length; index++) {
    const element = forms[index];
    element.addEventListener("formdata", (e) => {
      e.formData.append("script", monacoEditor.getModel().getValue());
    });
  }

  let languageDropdown = document.getElementById("id_language");
  languageDropdown.addEventListener("change", function (e) {
    selectedLanguage(monacoEditor.getModel(), e.target.value);
  });

  selectedLanguage(monacoEditor.getModel(), languageDropdown.value);

  window.getMonacoValue = function () {
    return monacoEditor.getModel().getValue();
  };
</script>

<!-- TODO: This CSS is very hackish, we *may* want to change it -->
<div
  id="id_{{ widget.name }}"
  name="{{ widget.name }}"
  style="height: 30em"
  class="is-invalid"
></div>
